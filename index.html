<!DOCTYPE html><html lang="th"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>OrbitGrid LiveBench | Business Platform</title></head><body><section id="upload"><div class="mode"><label>โหมด <span id="modeLabel">Local</span> <input type="checkbox" id="modeCk"/> Server/Cloud</label></div><div><input id="fileA" type="file" accept=".csv,.json"/><input id="fileB" type="file" accept=".csv,.json"/><button id="btnLoad">โหลดข้อมูล</button></div><div id="schema">เลือกไฟล์ A และ B</div><div id="serverPanel" style="display:none"><h3>Server Processing</h3><p>POST https://api.example.com/livebench/process (mock)</p><button id="btnSend">ส่งไป Server (mock)</button><span id="sendStatus"></span></div><div id="privacyNote">Local: ประมวลผลในเบราว์เซอร์เท่านั้น</div><div id="cloudNote" style="display:none">Server/Cloud: ส่งไฟล์ไปยัง API ภายนอก โปรดตรวจนโยบายข้อมูล</div></section><section id="compare"><input id="th" type="range" min="0" max="1" step="0.05" value="0.3"/><div id="heatmap"></div><div id="highlights"></div><div id="drill"></div><div id="table"></div><button id="btnExportCsv">CSV</button><button id="btnExportPng">PNG</button></section><script>function parseCSV(t){const[h,...l]=t.trim().split(/\r?\n/);const s=h.split(',');return l.filter(Boolean).map(e=>{const n=e.split(','),r={};return s.forEach((c,i)=>r[c]=n[i]),r})}async function readFile(i){const f=i.files?.[0];if(!f)return null;const x=await f.text();return /\.json$/i.test(f.name)?JSON.parse(x):parseCSV(x)}const num=v=>{const n=Number(v);return Number.isFinite(n)?n:null};let dataA=null,dataB=null,lastMatrix=[],mode='local';function setMode(m){mode=m;document.getElementById('modeLabel').textContent=m==='server'?'Server/Cloud':'Local';document.getElementById('serverPanel').style.display=m==='server'?'block':'none';document.getElementById('cloudNote').style.display=m==='server'?'block':'none';document.getElementById('privacyNote').style.display=m==='server'?'none':'block'}document.getElementById('modeCk').addEventListener('change',e=>setMode(e.target.checked?'server':'local'));async function load(){dataA=await readFile(document.getElementById('fileA'));dataB=await readFile(document.getElementById('fileB'));const s=document.getElementById('schema');if(!dataA||!dataB){s.textContent='กรุณาเลือกไฟล์ให้ครบทั้ง A และ B';return}const keysA=Object.keys(dataA[0]||{}),keysB=Object.keys(dataB[0]||{});const common=keysA.filter(k=>keysB.includes(k));const numeric=common.filter(k=>num(dataA[0][k])!=null&&num(dataB[0][k])!=null);s.textContent=`Fields ที่เทียบได้: ${numeric.join(', ')||'ไม่มี'}`;const rows=Math.min(5,dataA.length,dataB.length),cols=Math.min(5,numeric.length);const matrix=[];for(let r=0;r<rows;r++){const row=[];for(let c=0;c<cols;c++){const k=numeric[c],a=num(dataA[r][k]),b=num(dataB[r][k]);const diff=(a==null||b==null)?0:Math.abs(a-b)/(Math.abs(a)+Math.abs(b)||1);row.push({k,r,c,diff,a,b})}matrix.push(row)}lastMatrix=matrix;renderHeatmap();renderHighlights();renderTable()}function colorFor(v){const r=v<0.5?Math.round(255*v*2):255,g=v<0.5?255:Math.round(255*(1-(v-0.5)*2)),b=Math.round(120*(1-v));return`rgb(${r},${g},${b})`}function renderHeatmap(){const th=parseFloat(document.getElementById('th').value||'0.3');const el=document.getElementById('heatmap');if(!el)return;el.innerHTML='';lastMatrix.forEach((row,ri)=>row.forEach(cell=>{const d=document.createElement('div');const v=cell.diff;d.title=`row ${ri+1} col ${cell.k}: diff=${v.toFixed(2)}`;d.style.cssText=`height:36px;border-radius:8px;background:${colorFor(v)};outline:${v>th?'2px solid #111':''};display:inline-block;width:calc(20% - 6px);margin:3px;`;d.addEventListener('click',()=>{const dd=document.getElementById('drill');if(dd) dd.textContent=`Row ${ri+1} ${cell.k}: A=${cell.a} B=${cell.b} | diff=${v.toFixed(3)}`});el.appendChild(d)}))}function renderHighlights(){const th=parseFloat(document.getElementById('th').value||'0.3');const el=document.getElementById('highlights');if(!el)return;el.innerHTML='';const flat=lastMatrix.flat();flat.sort((a,b)=>b.diff-a.diff).slice(0,10).forEach(cell=>{const chip=document.createElement('span');chip.style.cssText='display:inline-block;margin:4px;padding:4px 8px;border-radius:999px;border:1px solid #e6eaf2;font-size:12px;';const hot=cell.diff>th;chip.style.background=hot?'#fff5f5':'#f0fdf9';chip.style.borderColor=hot?'#ffd7d7':'#ccfbf1';chip.textContent=`${cell.k} r${cell.r+1} Δ=${cell.diff.toFixed(2)}`;el.appendChild(chip)})}function renderTable(){const el=document.getElementById('table');if(!el)return;el.innerHTML='';const t=document.createElement('table');t.style.width='100%';t.style.borderCollapse='collapse';t.innerHTML='<thead><tr><th>Row</th><th>Field</th><th>A</th><th>B</th><th>Δ</th></tr></thead>';const tb=document.createElement('tbody');lastMatrix.forEach((row,ri)=>row.forEach(cell=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${ri+1}</td><td>${cell.k}</td><td>${cell.a??''}</td><td>${cell.b??''}</td><td>${cell.diff.toFixed(3)}</td>`;tb.appendChild(tr)}));t.appendChild(tb);el.appendChild(t)}function exportCSV(){const rows=[['row','field','A','B','diff']];lastMatrix.forEach((row,ri)=>row.forEach(cell=>rows.push([ri+1,cell.k,cell.a,cell.b,cell.diff])));const csv=rows.map(r=>r.join(',')).join('\n');const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='comparison.csv';a.click();URL.revokeObjectURL(a.href)}async function exportPNG(){const heat=document.getElementById('heatmap');if(!heat)return;const rect=heat.getBoundingClientRect();const w=rect.width,h=rect.height;const canvas=document.createElement('canvas');canvas.width=w;canvas.height=h;const ctx=canvas.getContext('2d');const cells=[...heat.children];const cols=5,gap=6;const cw=(w-(cols-1)*gap)/cols,ch=36;cells.forEach((c,i)=>{const col=i%cols,row=Math.floor(i/cols);const x=col*(cw+gap),y=row*(ch+gap);ctx.fillStyle=getComputedStyle(c).backgroundColor;ctx.fillRect(x,y,cw,ch)});canvas.toBlob(b=>{const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='heatmap.png';a.click();URL.revokeObjectURL(a.href)})}async function sendToServer(){const st=document.getElementById('sendStatus');try{const a=document.getElementById('fileA').files?.[0];const b=document.getElementById('fileB').files?.[0];if(!a||!b){st.textContent='กรุณาเลือกไฟล์ก่อน';return}const fd=new FormData();fd.append('fileA',a);fd.append('fileB',b);fd.append('threshold',document.getElementById('th').value||'0.3');st.textContent='กำลังส่ง...';const res=await fetch('https://api.example.com/livebench/process',{method:'POST',headers:{'Authorization':'Bearer DEMO_TOKEN'},body:fd});st.textContent=`เสร็จสิ้น (mock): ${res.status}`;}catch(err){st.textContent='ส่งไม่สำเร็จ (mock): '+err}}document.getElementById('btnSend')?.addEventListener('click',sendToServer);document.getElementById('btnLoad').addEventListener('click',load);document.getElementById('th').addEventListener('input',()=>{renderHeatmap();renderHighlights()});document.getElementById('btnExportCsv').addEventListener('click',exportCSV);document.getElementById('btnExportPng').addEventListener('click',exportPNG);</script></body></html>
